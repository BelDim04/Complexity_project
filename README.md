# Rural Postman Problem  
(Задача о деревенском почтальоне)

## Постановка задачи
Дан граф $G=(V,E)$, веса рёбер $w:E \rightarrow N$, и множество рёбер $R \subset E$. Требуется найти цикл минимального суммарного веса, хотя бы один раз проходящий через каждое ребро из $R$.

## $\bf{NP}$-полнота
### $\bf{NP}$-трудность.
К задаче RPP сводим метрическую задачу коммивояжёра (TSP). Пусть $(G,w)$ — пример задачи TSP, где $G$ — граф и $w$ - стоимости рёбер. Построим пример $(G', w', R)$ задачи RPP:
граф $G'$ получается из $G$ добавлением петли нулевой стоимости к каждой вершине. Множество $R$ состоит из добавленных петель. Теперь любое решение $W$ для примера TSP $(G, w)$ превращается в решение $W'$ примера RPP $(G', w', R)$ добавлением к $W$ петель из $R$. С другой стороны любое решение $W'$ для примера RPP $(G', w', R)$ превращается в решение $W$ для примера TSP $(G, w)$ сокращением повторных посещений вершин. Стоимость оптимальных решений в двух примерах совпадает.
### Принадлежность к классу $\bf{NP}$
Версия «decision problem» (то есть такая, в которой ставится вопрос, существует ли маршрут не длиннее, чем заданное значение k) относится к классу NP-полных задач c есественным сертификатом $S$ - маршрутом почтальона.

---
## Полиномиальный алгоритм
Построим алгоритм для RPP, который работает за полиномиальное время, когда число $c$ компонент связности графа $G \left\langle R \right\rangle$ — константа.

Очевидно, что задача RPP $(G', w', R)$ сводится к задачи RPP $(G, w, R)$, где $G$ - полный граф, $w$ - удовлетворяет неравенству треугольника. Докажем алгоритм в таких предположениях.

### Лемма
Пусть $(G, w, R)$ - задача RPP, $W$ - её решение. Тогда $W=R \sqcup T \sqcup M$, где  
$T$ - $c - 1$ ребро т.ч. $G \left\langle R \sqcup T \right\rangle$ - связный  
$M$ - совершенное паросочетание в G на вершинах нечетной степени в $G \left\langle R \sqcup T \right\rangle$.

$\bf{Доказательство}$  
Разобьем $W \setminus R$ на $T \sqcup M$ так, что $T$ - минимальное по включению множество рёбер, что $G \left\langle R \sqcup T \right\rangle$ - связный, очевидно что его мощность равна $c - 1$.  
Докажем, что $M$ - паросочетание. Пусть нет, тогда найдем два ребра $(u,v),(v,w) \in M$ и заменим их на одно ребро $(u, w)$, ответ не станет хуже по неравенству треугольника. Так как в $W$ нет вершин нечётной степени, то $M$ - паросочетание на вершинах нечётных степеней из $G \left\langle R \sqcup T \right\rangle$.

### Теорема
Задача о сельском почтальоне решается за $O(n^{2c-2} \cdot n^3))$, где $c$ - число компонент связности в $G \left\langle R \right\rangle$  

$\bf{Доказательство}$ 
Достаточно перебирать все возможные множества $T$ из леммы. Таких $O(n^{2c−2})$, ведь выбираем две конечные вершины для каждого из $c−1$ рёбер. Для каждого множества $T$ вычисляем совершенное паросочетание минимального веса $M$ в графе $G$ на нечётных вершинах в $G \left\langle R \sqcup T \right\rangle$ за время $O(n^3)$. Из всех перебранных $T$ и $M$ возвращаем решение $R \sqcup M \sqcup T$ минимальной стоимости.

### Анализ производительности
[analysis.ipynb]
